
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>parzec - lexer</title>
    <link rel="icon" type="image/icon" href="../images/favicon.png" />
    <link rel="stylesheet" href="../css/main.css" />
    
    
</head>
<body>
    
    <div class="navbar">
        <div class="navmenu">
            
    <a class="title enabled" href="../index.html">
        <img src=".." />
        <span>parzec</span>
    </a>
    <a class="enabled" href="https://www.npmjs.com/package/parzec">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M288 288h-32v-64h32v64zm288-128v192H288v32H160v-32H0V160h576zm-416 32H32v128h64v-96h32v96h32V192zm160 0H192v160h64v-32h64V192zm224 0H352v128h64v-96h32v96h32v-96h32v96h32V192z"/></svg>
        <span>Download</span>
    </a>
    <a class="enabled" href="https://github.com/johtela/parzec">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
        <span>GitHub</span>
    </a>
    <a class="enabled" href="../license.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zM64 72c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8V72zm0 64c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8v-16zm192.81 248H304c8.84 0 16 7.16 16 16s-7.16 16-16 16h-47.19c-16.45 0-31.27-9.14-38.64-23.86-2.95-5.92-8.09-6.52-10.17-6.52s-7.22.59-10.02 6.19l-7.67 15.34a15.986 15.986 0 0 1-14.31 8.84c-.38 0-.75-.02-1.14-.05-6.45-.45-12-4.75-14.03-10.89L144 354.59l-10.61 31.88c-5.89 17.66-22.38 29.53-41 29.53H80c-8.84 0-16-7.16-16-16s7.16-16 16-16h12.39c4.83 0 9.11-3.08 10.64-7.66l18.19-54.64c3.3-9.81 12.44-16.41 22.78-16.41s19.48 6.59 22.77 16.41l13.88 41.64c19.77-16.19 54.05-9.7 66 14.16 2.02 4.06 5.96 6.5 10.16 6.5zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"/></svg>
        <span>License</span>
    </a>
    <a class="enabled" href="error.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"/></svg>
        <span>Previous: error</span>
    </a>
    <a class="enabled" href="ref.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34zm192-34l-136-136c-9.4-9.4-24.6-9.4-33.9 0l-22.6 22.6c-9.4 9.4-9.4 24.6 0 33.9l96.4 96.4-96.4 96.4c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l136-136c9.4-9.2 9.4-24.4 0-33.8z"/></svg>
        <span>Next: ref</span>
    </a>
        </div>
        
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
    </div>
    
    <div class="layout">
        <div class="sidepane collapsible">
            
    <div class="tocmenu">
        <h3>Table of Contents</h3>
        
    <ul>
        
    <li>
        
        <a href="../README.html">README</a>
        
    </li>
    <li>
        
        <a href="index.html">index</a>
        
    </li>
    <li>
        
        <a href="input.html">input</a>
        
    </li>
    <li>
        
        <a href="result.html">result</a>
        
    </li>
    <li>
        
        <a href="error.html">error</a>
        
    </li>
    <li>
        
        <a href="lexer.html" class="highlight">lexer</a>
        
    </li>
    <li>
        
        <a href="ref.html">ref</a>
        
    </li>
    <li>
        
        <a href="parser.html">parser</a>
        
    </li>
    <li>
        
        <a href="arrayparsers.html">arrayparsers</a>
        
    </li>
    <li>
        
        <a href="utils.html">utils</a>
        
    </li>
    <li>
        
        <a href="test/exprparser.html">exprparser</a>
        
    </li>
    <li>
        
        <a href="test/exprtests.html">exprtests</a>
        
    </li>
    <li>
        
        <a href="test/jsonparser.html">jsonparser</a>
        
    </li>
    <li>
        
        <a href="test/jsontests.html">jsontests</a>
        
    </li>
    </ul>
    </div>
            
        </div>
        <div class="sideicon collapsible">
            
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
        </div>
        <div class="scrollingarea closepopups">
            
    <div class="contentarea">
        <pre class="syntaxhighlight"><code>/**
 * @module
</code></pre>
<h2 id="pre-class-syntaxhighlight-code-span-class-keyword-import-span-span-class-punctuation-span-span-id-810-data-toggle-tooltip-data-title-any-parser-input-span-span-class-punctuation-span-span-class-keyword-from-span-span-class-string-quot-input-quot-span-span-class-keyword-import-span-span-class-punctuation-span-span-id-849-data-toggle-tooltip-data-title-text-string-gt-string-escape-whitespace-span-span-class-punctuation-span-span-class-keyword-from-span-span-class-string-quot-utils-quot-span-span-class-keyword-import-span-span-class-punctuation-span-span-id-893-data-toggle-tooltip-data-title-typeof-parse-error-parse-error-span-span-class-punctuation-span-span-id-905-data-toggle-tooltip-data-title-typeof-error-source-error-source-span-span-class-punctuation-span-span-class-keyword-from-span-span-class-string-quot-error-quot-span-code-pre-recognizing-a-token"><pre class="syntaxhighlight"><code><span class="keyword">import</span> <span class="punctuation">{</span> <span id="810" data-toggle="tooltip" data-title="any">ParserInput</span> <span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">&quot;./input&quot;</span>
<span class="keyword">import</span> <span class="punctuation">{</span> <span id="849" data-toggle="tooltip" data-title="(text: string) =&gt; string">escapeWhitespace</span> <span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">&quot;./utils&quot;</span>
<span class="keyword">import</span> <span class="punctuation">{</span> <span id="893" data-toggle="tooltip" data-title="typeof ParseError">ParseError</span><span class="punctuation">,</span> <span id="905" data-toggle="tooltip" data-title="typeof ErrorSource">ErrorSource</span> <span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">&quot;./error&quot;</span>
</code></pre>
Recognizing a Token</h2>
<p>The mapping from regular expressions to tokens is defined using the <code>TokenMatcher&lt;S&gt;</code>
interface. A token can be of any type <code>S</code>, although usually an enumeration is used.</p>
<h2 id="pre-class-syntaxhighlight-code-span-class-keyword-interface-span-span-id-934-class-typename-data-toggle-tooltip-data-title-token-matcher-lt-s-gt-token-matcher-span-span-class-punctuation-lt-span-span-id-1197-data-toggle-tooltip-data-title-s-s-span-span-class-punctuation-gt-span-span-class-punctuation-span-span-id-1201-data-toggle-tooltip-data-title-reg-exp-regex-span-span-class-punctuation-span-span-class-typename-data-toggle-tooltip-data-title-reg-exp-reg-exp-span-span-id-1220-data-toggle-tooltip-data-title-s-token-span-span-class-punctuation-span-a-href-lexer-html-1197-span-data-toggle-tooltip-data-title-s-s-span-a-span-class-punctuation-span-code-pre-representing-a-token"><pre class="syntaxhighlight"><code><span class="keyword">interface</span> <span id="934" class="typename" data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;">TokenMatcher</span><span class="punctuation">&lt;</span><span id="1197" data-toggle="tooltip" data-title="S">S</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
<span id="1201" data-toggle="tooltip" data-title="RegExp">regex</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span>
<span id="1220" data-toggle="tooltip" data-title="S">token</span><span class="punctuation">:</span> <a href="lexer.html#1197"><span data-toggle="tooltip" data-title="S">S</span></a>
<span class="punctuation">}</span>
</code></pre>
Representing a Token</h2>
<p>When a token is recognized it is wrapped into the <code>Token&lt;S&gt;</code> class. This class
contains also the recognized string for error reporting and diagnostics.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">class</span> <span id="1237" class="typename" data-toggle="tooltip" data-title="Token&lt;S&gt;">Token</span><span class="punctuation">&lt;</span><span id="1478" data-toggle="tooltip" data-title="S">S</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span id="1482" data-toggle="tooltip" data-title="S">token</span><span class="punctuation">:</span> <a href="lexer.html#1478"><span data-toggle="tooltip" data-title="S">S</span></a>
    <span id="1496" data-toggle="tooltip" data-title="string">text</span><span class="punctuation">:</span> <span class="keyword">string</span>
    
    <span class="keyword">constructor</span><span class="punctuation">(</span><span id="1538" data-toggle="tooltip" data-title="S">token</span><span class="punctuation">:</span> <a href="lexer.html#1478"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">,</span> <span id="1547" data-toggle="tooltip" data-title="string">text</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#1482"><span data-toggle="tooltip" data-title="S">token</span></a> <span class="punctuation">=</span> <a href="lexer.html#1538"><span data-toggle="tooltip" data-title="S">token</span></a>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#1496"><span data-toggle="tooltip" data-title="string">text</span></a> <span class="punctuation">=</span> <a href="lexer.html#1547"><span data-toggle="tooltip" data-title="string">text</span></a>
    <span class="punctuation">}</span>
</code></pre>
<p>We override the <code>toString()</code> function so we can output a token
to screen.</p>
<h2 id="pre-class-syntaxhighlight-code-span-id-1624-class-member-data-toggle-tooltip-data-title-gt-string-s-to-string-span-span-class-punctuation-span-span-class-punctuation-span-span-class-punctuation-span-span-class-keyword-return-span-span-class-keyword-this-span-span-class-punctuation-span-a-href-lexer-html-1496-span-data-toggle-tooltip-data-title-string-text-span-a-span-class-punctuation-span-a-href-lexer-html-849-span-data-toggle-tooltip-data-title-text-string-gt-string-escape-whitespace-span-a-span-class-punctuation-span-span-class-keyword-this-span-span-class-punctuation-span-a-href-lexer-html-1496-span-data-toggle-tooltip-data-title-string-text-span-a-span-class-punctuation-span-span-class-punctuation-span-span-class-keyword-this-span-span-class-punctuation-span-a-href-lexer-html-1482-span-data-toggle-tooltip-data-title-s-token-span-a-span-class-punctuation-span-span-class-punctuation-span-code-pre-lexer"><pre class="syntaxhighlight"><code>    <span id="1624" class="member" data-toggle="tooltip" data-title="() =&gt; string | S">toString</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
<span class="keyword">return</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#1496"><span data-toggle="tooltip" data-title="string">text</span></a> <span class="punctuation">?</span> <a href="lexer.html#849"><span data-toggle="tooltip" data-title="(text: string) =&gt; string">escapeWhitespace</span></a><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#1496"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">)</span> <span class="punctuation">:</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#1482"><span data-toggle="tooltip" data-title="S">token</span></a>
<span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
Lexer</h2>
<p>The lexer itself is a simple class that contains all the TokenMatchers and
recognizes the next token in a string.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">class</span> <span id="1830" class="typename" data-toggle="tooltip" data-title="Lexer&lt;S&gt;">Lexer</span><span class="punctuation">&lt;</span><span id="2005" data-toggle="tooltip" data-title="S">S</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">private</span> <span id="2009" data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;[]">matchers</span><span class="punctuation">:</span> <a href="lexer.html#934"><span class="typename" data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;">TokenMatcher</span></a><span class="punctuation">&lt;</span><a href="lexer.html#2005"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<p>The constructor adds two flags to the regular expressions given as
arguments. The <code>y</code> flag makes the search sticky so that it scans the
input string from the position indicated by the <code>lastIndex</code> property.
The <code>u</code> flag makes the search support unicode characters.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">constructor</span><span class="punctuation">(</span><span class="punctuation">...</span><span id="2383" data-toggle="tooltip" data-title="[RegExp, S][]">tokens</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span><span class="punctuation">,</span> <a href="lexer.html#2005"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">]</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#2009"><span data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;[]">matchers</span></a> <span class="punctuation">=</span> <a href="lexer.html#2383"><span data-toggle="tooltip" data-title="[RegExp, S][]">tokens</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(callbackfn: (value: [RegExp, S], index: number, array: [RegExp, S][]) =&gt; U, thisArg?: any) =&gt; U[]">map</span><span class="punctuation">(</span><span id="2447" data-toggle="tooltip" data-title="[RegExp, S]">t</span> <span class="punctuation">=&gt;</span> <span class="punctuation">(</span><span class="punctuation">{</span>
            <span id="2454" data-toggle="tooltip" data-title="RegExp">regex</span><span class="punctuation">:</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><a href="lexer.html#2447"><span data-toggle="tooltip" data-title="[RegExp, S]">t</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;yu&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>
            <span id="2498" data-toggle="tooltip" data-title="S">token</span><span class="punctuation">:</span> <a href="lexer.html#2447"><span data-toggle="tooltip" data-title="[RegExp, S]">t</span></a><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>
        <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span>    
    <span class="punctuation">}</span>
</code></pre>
<p>We check matchers one-by-one in the order they were given to
recognize the token in the given position. If none of the matchers
succeed, we return null.</p>
<h2 id="pre-class-syntaxhighlight-code-span-id-2547-class-member-data-toggle-tooltip-data-title-input-string-pos-number-gt-token-lt-s-gt-null-match-token-span-span-class-punctuation-span-span-id-2759-data-toggle-tooltip-data-title-string-input-span-span-class-punctuation-span-span-class-keyword-string-span-span-class-punctuation-span-span-id-2773-data-toggle-tooltip-data-title-number-pos-span-span-class-punctuation-span-span-class-keyword-number-span-span-class-punctuation-span-span-class-punctuation-span-a-href-lexer-html-1237-span-class-typename-data-toggle-tooltip-data-title-token-lt-s-gt-token-span-a-span-class-punctuation-lt-span-a-href-lexer-html-2005-span-data-toggle-tooltip-data-title-s-s-span-a-span-class-punctuation-gt-span-span-class-punctuation-span-span-class-keyword-null-span-span-class-punctuation-span-span-class-keyword-for-span-span-class-punctuation-span-span-class-keyword-let-span-span-id-2823-data-toggle-tooltip-data-title-number-i-span-span-class-punctuation-span-span-class-number-0-span-span-class-punctuation-span-a-href-lexer-html-2823-span-data-toggle-tooltip-data-title-number-i-span-a-span-class-punctuation-lt-span-span-class-keyword-this-span-span-class-punctuation-span-a-href-lexer-html-2009-span-data-toggle-tooltip-data-title-token-matcher-lt-s-gt-matchers-span-a-span-class-punctuation-span-span-data-toggle-tooltip-data-title-number-length-span-span-class-punctuation-span-a-href-lexer-html-2823-span-data-toggle-tooltip-data-title-number-i-span-a-span-class-punctuation-span-span-class-punctuation-span-span-class-punctuation-span-span-class-keyword-let-span-span-id-2880-data-toggle-tooltip-data-title-token-matcher-lt-s-gt-matcher-span-span-class-punctuation-span-span-class-keyword-this-span-span-class-punctuation-span-a-href-lexer-html-2009-span-data-toggle-tooltip-data-title-token-matcher-lt-s-gt-matchers-span-a-span-class-punctuation-span-a-href-lexer-html-2823-span-data-toggle-tooltip-data-title-number-i-span-a-span-class-punctuation-span-a-href-lexer-html-2880-span-data-toggle-tooltip-data-title-token-matcher-lt-s-gt-matcher-span-a-span-class-punctuation-span-a-href-lexer-html-1201-span-data-toggle-tooltip-data-title-reg-exp-regex-span-a-span-class-punctuation-span-span-data-toggle-tooltip-data-title-number-last-index-span-span-class-punctuation-span-a-href-lexer-html-2773-span-data-toggle-tooltip-data-title-number-pos-span-a-span-class-keyword-let-span-span-id-2967-data-toggle-tooltip-data-title-reg-exp-exec-array-null-match-span-span-class-punctuation-span-a-href-lexer-html-2880-span-data-toggle-tooltip-data-title-token-matcher-lt-s-gt-matcher-span-a-span-class-punctuation-span-a-href-lexer-html-1201-span-data-toggle-tooltip-data-title-reg-exp-regex-span-a-span-class-punctuation-span-span-class-member-data-toggle-tooltip-data-title-string-string-gt-reg-exp-exec-array-null-exec-span-span-class-punctuation-span-a-href-lexer-html-2759-span-data-toggle-tooltip-data-title-string-input-span-a-span-class-punctuation-span-span-class-keyword-if-span-span-class-punctuation-span-a-href-lexer-html-2967-span-data-toggle-tooltip-data-title-reg-exp-exec-array-null-match-span-a-span-class-punctuation-span-span-class-keyword-null-span-span-class-punctuation-span-span-class-keyword-return-span-span-class-keyword-new-span-a-href-lexer-html-1237-span-class-typename-data-toggle-tooltip-data-title-typeof-token-token-span-a-span-class-punctuation-lt-span-a-href-lexer-html-2005-span-data-toggle-tooltip-data-title-s-s-span-a-span-class-punctuation-gt-span-span-class-punctuation-span-a-href-lexer-html-2880-span-data-toggle-tooltip-data-title-token-matcher-lt-s-gt-matcher-span-a-span-class-punctuation-span-a-href-lexer-html-1220-span-data-toggle-tooltip-data-title-s-token-span-a-span-class-punctuation-span-a-href-lexer-html-2967-span-data-toggle-tooltip-data-title-reg-exp-exec-array-match-span-a-span-class-punctuation-span-span-class-number-0-span-span-class-punctuation-span-span-class-punctuation-span-span-class-punctuation-span-span-class-keyword-return-span-span-class-keyword-null-span-span-class-punctuation-span-span-class-punctuation-span-code-pre-lexer-input-wrapper"><pre class="syntaxhighlight"><code>    <span id="2547" class="member" data-toggle="tooltip" data-title="(input: string, pos: number) =&gt; Token&lt;S&gt; | null">matchToken</span><span class="punctuation">(</span><span id="2759" data-toggle="tooltip" data-title="string">input</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="2773" data-toggle="tooltip" data-title="number">pos</span><span class="punctuation">:</span> <span class="keyword">number</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="lexer.html#1237"><span class="typename" data-toggle="tooltip" data-title="Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="lexer.html#2005"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span> <span class="punctuation">|</span> <span class="keyword">null</span> <span class="punctuation">{</span>
<span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="2823" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <span class="number">0</span><span class="punctuation">;</span> <a href="lexer.html#2823"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#2009"><span data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;[]">matchers</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">;</span> <a href="lexer.html#2823"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">++</span><span class="punctuation">)</span> <span class="punctuation">{</span>
<span class="keyword">let</span> <span id="2880" data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;">matcher</span> <span class="punctuation">=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#2009"><span data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;[]">matchers</span></a><span class="punctuation">[</span><a href="lexer.html#2823"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">]</span>
<a href="lexer.html#2880"><span data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;">matcher</span></a><span class="punctuation">.</span><a href="lexer.html#1201"><span data-toggle="tooltip" data-title="RegExp">regex</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lastIndex</span> <span class="punctuation">=</span> <a href="lexer.html#2773"><span data-toggle="tooltip" data-title="number">pos</span></a>
<span class="keyword">let</span> <span id="2967" data-toggle="tooltip" data-title="RegExpExecArray | null">match</span> <span class="punctuation">=</span> <a href="lexer.html#2880"><span data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;">matcher</span></a><span class="punctuation">.</span><a href="lexer.html#1201"><span data-toggle="tooltip" data-title="RegExp">regex</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray | null">exec</span><span class="punctuation">(</span><a href="lexer.html#2759"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">)</span>
<span class="keyword">if</span> <span class="punctuation">(</span><a href="lexer.html#2967"><span data-toggle="tooltip" data-title="RegExpExecArray | null">match</span></a> <span class="punctuation">!=</span> <span class="keyword">null</span><span class="punctuation">)</span>
<span class="keyword">return</span> <span class="keyword">new</span> <a href="lexer.html#1237"><span class="typename" data-toggle="tooltip" data-title="typeof Token">Token</span></a><span class="punctuation">&lt;</span><a href="lexer.html#2005"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">(</span><a href="lexer.html#2880"><span data-toggle="tooltip" data-title="TokenMatcher&lt;S&gt;">matcher</span></a><span class="punctuation">.</span><a href="lexer.html#1220"><span data-toggle="tooltip" data-title="S">token</span></a><span class="punctuation">,</span> <a href="lexer.html#2967"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
<span class="keyword">return</span> <span class="keyword">null</span>
<span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
Lexer Input Wrapper</h2>
<p>We can integrate lexing directly into the parsing process. We do this by
implementing the <code>ParserInput</code> interface for any token. We don't expose
<code>LexerInput</code> outside the module. It can be created with a constructor
function.</p>
<pre class="syntaxhighlight"><code><span class="keyword">class</span> <span id="3137" class="typename" data-toggle="tooltip" data-title="LexerInput&lt;S&gt;">LexerInput</span><span class="punctuation">&lt;</span><span id="3457" data-toggle="tooltip" data-title="S">S</span><span class="punctuation">&gt;</span> <span class="keyword">implements</span> <a href="lexer.html#810"><span data-toggle="tooltip" data-title="ParserInput&lt;S&gt;">ParserInput</span></a><span class="punctuation">&lt;</span><a href="lexer.html#1237"><span class="typename" data-toggle="tooltip" data-title="Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="lexer.html#3457"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
</code></pre>
<p>We define the fields of the <code>ParserInput</code> interface in a boilerplate manner.</p>
<pre class="syntaxhighlight"><code>    <span id="3494" data-toggle="tooltip" data-title="number">position</span><span class="punctuation">:</span> <span class="keyword">number</span>
    <span id="3619" data-toggle="tooltip" data-title="Token&lt;S&gt;">current</span><span class="punctuation">:</span> <a href="lexer.html#1237"><span class="typename" data-toggle="tooltip" data-title="Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="lexer.html#3457"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span>
    <span id="3642" data-toggle="tooltip" data-title="any">state</span><span class="punctuation">:</span> <span class="keyword">any</span>
</code></pre>
<p>We also need to store the input string and the lexer used. These we
get as an argument.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">private</span> <span id="3658" data-toggle="tooltip" data-title="string">input</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span class="keyword">private</span> <span id="3807" data-toggle="tooltip" data-title="Lexer&lt;S&gt;">lexer</span><span class="punctuation">:</span> <a href="lexer.html#1830"><span class="typename" data-toggle="tooltip" data-title="Lexer&lt;S&gt;">Lexer</span></a><span class="punctuation">&lt;</span><a href="lexer.html#3457"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span>
</code></pre>
<p>To avoid recognizing the same token multiple times as the parser
backtracks, we store all the tokens we have matched so far in
an array.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">private</span> <span id="3836" data-toggle="tooltip" data-title="Token&lt;S&gt;[]">tokens</span><span class="punctuation">:</span> <a href="lexer.html#1237"><span class="typename" data-toggle="tooltip" data-title="Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="lexer.html#3457"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<p>We also store the result designating end of the input.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">private</span> <span id="4048" data-toggle="tooltip" data-title="{ done: boolean; value: Token&lt;S&gt;; }">eof</span> <span class="punctuation">=</span> <span class="punctuation">{</span> <span id="4150" data-toggle="tooltip" data-title="boolean">done</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span id="4162" data-toggle="tooltip" data-title="Token&lt;S&gt;">value</span><span class="punctuation">:</span> <span class="punctuation">&lt;</span><a href="lexer.html#1237"><span class="typename" data-toggle="tooltip" data-title="Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="lexer.html#3457"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">&gt;</span><span class="punctuation">&lt;</span><span class="keyword">unknown</span><span class="punctuation">&gt;</span><span data-toggle="tooltip" data-title="undefined">undefined</span> <span class="punctuation">}</span>
</code></pre>
<p>Create an input stream for given string and lexer. Initialize the
instance variables.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">constructor</span><span class="punctuation">(</span><span id="4338" data-toggle="tooltip" data-title="string">input</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="4352" data-toggle="tooltip" data-title="Lexer&lt;S&gt;">lexer</span><span class="punctuation">:</span> <a href="lexer.html#1830"><span class="typename" data-toggle="tooltip" data-title="Lexer&lt;S&gt;">Lexer</span></a><span class="punctuation">&lt;</span><a href="lexer.html#3457"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3658"><span data-toggle="tooltip" data-title="string">input</span></a> <span class="punctuation">=</span> <a href="lexer.html#4338"><span data-toggle="tooltip" data-title="string">input</span></a>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3807"><span data-toggle="tooltip" data-title="Lexer&lt;S&gt;">lexer</span></a> <span class="punctuation">=</span> <a href="lexer.html#4352"><span data-toggle="tooltip" data-title="Lexer&lt;S&gt;">lexer</span></a>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3836"><span data-toggle="tooltip" data-title="Token&lt;S&gt;[]">tokens</span></a> <span class="punctuation">=</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="ArrayConstructor">Array</span><span class="punctuation">&lt;</span><a href="lexer.html#1237"><span class="typename" data-toggle="tooltip" data-title="Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="lexer.html#3457"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">&gt;</span><span class="punctuation">(</span><a href="lexer.html#4338"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">)</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3494"><span data-toggle="tooltip" data-title="number">position</span></a> <span class="punctuation">=</span> <span class="punctuation">-</span><span class="number">1</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3619"><span data-toggle="tooltip" data-title="Token&lt;S&gt;">current</span></a> <span class="punctuation">=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#4048"><span data-toggle="tooltip" data-title="{ done: boolean; value: Token&lt;S&gt;; }">eof</span></a><span class="punctuation">.</span><a href="lexer.html#4162"><span data-toggle="tooltip" data-title="Token&lt;S&gt;">value</span></a>
    <span class="punctuation">}</span>
</code></pre>
<p>The iterator implementation is fairly straightforward. We need to make sure
that the state variables <code>position</code> and <code>current</code> are kept in sync while we
advance in the input string. We must also do a lookup in the caché
before calling the lexer to recognize the token. If the lexer finds a
match, we update the caché. If the lexer cannot recognize the next token,
we throw a <code>ParseError</code>.</p>
<pre class="syntaxhighlight"><code>    <span id="4558" class="member" data-toggle="tooltip" data-title="() =&gt; IteratorResult&lt;Token&lt;S&gt;, any&gt;">next</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="IteratorResult&lt;T, TReturn&gt;">IteratorResult</span><span class="punctuation">&lt;</span><a href="lexer.html#1237"><span class="typename" data-toggle="tooltip" data-title="Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="lexer.html#3457"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="5067" data-toggle="tooltip" data-title="number">pos</span> <span class="punctuation">=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3494"><span data-toggle="tooltip" data-title="number">position</span></a>
        <a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a> <span class="punctuation">+=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3836"><span data-toggle="tooltip" data-title="Token&lt;S&gt;[]">tokens</span></a><span class="punctuation">[</span><a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a><span class="punctuation">]</span> <span class="punctuation">?</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3836"><span data-toggle="tooltip" data-title="Token&lt;S&gt;[]">tokens</span></a><span class="punctuation">[</span><a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a><span class="punctuation">]</span><span class="punctuation">.</span><a href="lexer.html#1496"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">:</span> <span class="number">1</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a> <span class="punctuation">&gt;=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3658"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">)</span>
            <span class="keyword">return</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#4048"><span data-toggle="tooltip" data-title="{ done: boolean; value: Token&lt;S&gt;; }">eof</span></a>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3494"><span data-toggle="tooltip" data-title="number">position</span></a> <span class="punctuation">=</span> <a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a>
        <span class="keyword">let</span> <span id="5265" data-toggle="tooltip" data-title="Token&lt;S&gt;">match</span> <span class="punctuation">=</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3836"><span data-toggle="tooltip" data-title="Token&lt;S&gt;[]">tokens</span></a><span class="punctuation">[</span><a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a><span class="punctuation">]</span> <span class="punctuation">||</span> <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3807"><span data-toggle="tooltip" data-title="Lexer&lt;S&gt;">lexer</span></a><span class="punctuation">.</span><a href="lexer.html#2547"><span class="member" data-toggle="tooltip" data-title="(input: string, pos: number) =&gt; Token&lt;S&gt; | null">matchToken</span></a><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3658"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">,</span> <a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="lexer.html#5265"><span data-toggle="tooltip" data-title="Token&lt;S&gt;">match</span></a><span class="punctuation">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> <a href="lexer.html#893"><span data-toggle="tooltip" data-title="typeof ParseError">ParseError</span></a><span class="punctuation">(</span><a href="lexer.html#905"><span data-toggle="tooltip" data-title="typeof ErrorSource">ErrorSource</span></a><span class="punctuation">.</span><a href="error.html#231"><span data-toggle="tooltip" data-title="ErrorSource.Lexer">Lexer</span></a><span class="punctuation">,</span> <a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a><span class="punctuation">,</span> 
                <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3658"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(from: number, length?: number | undefined) =&gt; string">substr</span><span class="punctuation">(</span><a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span> <span class="punctuation">+</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="string">&quot;&lt;valid token&gt;&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3836"><span data-toggle="tooltip" data-title="Token&lt;S&gt;[]">tokens</span></a><span class="punctuation">[</span><a href="lexer.html#5067"><span data-toggle="tooltip" data-title="number">pos</span></a><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="lexer.html#5265"><span data-toggle="tooltip" data-title="Token&lt;S&gt;">match</span></a>
        <span class="keyword">this</span><span class="punctuation">.</span><a href="lexer.html#3619"><span data-toggle="tooltip" data-title="Token&lt;S&gt;">current</span></a> <span class="punctuation">=</span> <a href="lexer.html#5265"><span data-toggle="tooltip" data-title="Token&lt;S&gt;">match</span></a>      
        <span class="keyword">return</span> <span class="punctuation">{</span> <span id="5572" data-toggle="tooltip" data-title="false">done</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span> <span id="5585" data-toggle="tooltip" data-title="Token&lt;S&gt;">value</span><span class="punctuation">:</span> <a href="lexer.html#5265"><span data-toggle="tooltip" data-title="Token&lt;S&gt;">match</span></a> <span class="punctuation">}</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>Create an input stream for given <code>text</code> string using the given <code>lexer</code>.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="5611" class="member" data-toggle="tooltip" data-title="&lt;S&gt;(text: string, lexer: Lexer&lt;S&gt;) =&gt; ParserInput&lt;Token&lt;S&gt;&gt;">lexerInput</span><span class="punctuation">&lt;</span><span id="5726" data-toggle="tooltip" data-title="S">S</span><span class="punctuation">&gt;</span><span class="punctuation">(</span><span id="5729" data-toggle="tooltip" data-title="string">text</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="5742" data-toggle="tooltip" data-title="Lexer&lt;S&gt;">lexer</span><span class="punctuation">:</span> <a href="lexer.html#1830"><span class="typename" data-toggle="tooltip" data-title="Lexer&lt;S&gt;">Lexer</span></a><span class="punctuation">&lt;</span><a href="lexer.html#5726"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="lexer.html#810"><span data-toggle="tooltip" data-title="ParserInput&lt;S&gt;">ParserInput</span></a><span class="punctuation">&lt;</span><a href="lexer.html#1237"><span class="typename" data-toggle="tooltip" data-title="Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="lexer.html#5726"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="keyword">new</span> <a href="lexer.html#3137"><span class="typename" data-toggle="tooltip" data-title="typeof LexerInput">LexerInput</span></a><span class="punctuation">&lt;</span><a href="lexer.html#5726"><span data-toggle="tooltip" data-title="S">S</span></a><span class="punctuation">&gt;</span><span class="punctuation">(</span><a href="lexer.html#5729"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">,</span> <a href="lexer.html#5742"><span data-toggle="tooltip" data-title="Lexer&lt;S&gt;">lexer</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>

        
    </div>
            <div class="stickypane">
                
    <div class="pagemenu">
        <h3>On This Page</h3>
            <ul class="pagetree">
                
            </ul>
    </div>
                
    <div class="footer">
        Copyright © 2020 Tommi Johtela
        <div class="ad">
            Created with <a href="https://github.com/johtela/litscript">LiTScript</a>
        </div>
    </div>

            </div>
        </div>
    </div>
    <script src="../js/main.js"></script>
    
</body>
</html>